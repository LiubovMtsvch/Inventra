@model CourseProjectitr.Models.Inventory

@{
    Layout = "_Layout";
}

<h2 class="mb-4"><i class="fas fa-boxes-stacked me-2"></i>Создание инвентаризации</h2>

<form asp-controller="Inventory" asp-action="Create" method="post">

    @Html.AntiForgeryToken()
    <table class="table-clean table table-bordered table-striped table-hover align-middle text-start">
        <thead class="table-light">
            <tr>
                <th><i class="fas fa-align-left"></i> Title</th>
                <th><i class="fas fa-align-left"></i> Description</th>
                <th><i class="fas fa-list"></i> Category</th>
                <th><i class="fas fa-image"></i> Image URL</th>
                <th><i class="fas fa-align-left"></i> Tag</th>
                <th><i class="fas fa-eye"></i> Make public</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <input asp-for="Title" class="form-control" />
                    <span asp-validation-for="Title" class="text-danger"></span>
                </td>
                <td>
                    <textarea asp-for="Description" class="form-control form-control-sm" rows="1" style="resize: none; overflow: hidden;"></textarea>
                </td>
                <td>
                    <select asp-for="Category" asp-items="ViewBag.Categories" class="form-select">
                        <option value="">-- Select category --</option>
                    </select>
                    <span asp-validation-for="Category" class="text-danger"></span>

                </td>
                <td>
                    <input asp-for="ImageUrl" class="form-control" />
                </td>
                <td>
                    <input id="tag-input" name="Tags" class="form-control" placeholder="Select tags" />
                    <input type="hidden" id="TagsJson" name="TagsJson" />

                </td>


                <td class="text-center">
                    <input asp-for="IsPublic" type="checkbox" class="form-check-input" />
                </td>
            </tr>
        </tbody>
    </table>

    <button type="submit" class="btn btn-success">
        <i class="fas fa-save me-1"></i> Сохранить инвентаризацию
    </button>
</form>


<script>
    const input = document.querySelector('input[name=Tags]');
    const preview = document.getElementById('tag-preview');


    const staticWhitelist = [
        "computer", "telephone", "tv", "monitor", "keyboard",
        "mouse", "printer", "scanner", "router", "modem"
    ];

    const mockAjax = (() => {
        let timeout;
        return function(duration) {
            clearTimeout(timeout);
            return new Promise(resolve => {
                timeout = setTimeout(() => resolve(staticWhitelist), duration || 700);
            });
        };
    })();

  
    const tagify = new Tagify(input, {
        enforceWhitelist: false,
        delimiters: ",",
        whitelist: staticWhitelist,
        dropdown: {
            enabled: 1, 
            maxItems: 10,
            classname: "tags-look",
            fuzzySearch: true,
            position: 'text',
            highlightFirst: true
        }
    });

    // 🧹 удаление title у тега
    tagify.on('add', e => {
        e.detail.tag.removeAttribute('title');
    });

   

    tagify.on('input', e => {
        tagify.whitelist = null;
        tagify.loading(true);

        mockAjax().then(result => {
            tagify.settings.whitelist = result.concat(tagify.value.map(t => t.value));
            tagify.loading(false);
            tagify.dropdown.show(e.detail.value);
        }).catch(() => tagify.dropdown.hide());
    });


    input.addEventListener('focus', () => {
        tagify.dropdown.show.call(tagify);
    });
</script>
